<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reborner 教师端 - 学习打卡系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #589010;
            --primary-light: #78B030;
            --primary-dark: #3A7000;
            --secondary-color: #A8C8E8;
            --accent-1: #F9D9D1;
            --accent-2: #FDD95E;
            --accent-3: #DAE8DE;
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #FFFEF7;
            --bg-white: #FFFFFF;
            --border-color: #E8E8E8;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --unchecked-color: #F9D9D1;
            --checked-color: #FDD95E;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-dark);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            position: relative;
            overflow-x: hidden;
        }
        
        /* 背景装饰元素 */
        body::before,
        body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            z-index: -1;
            opacity: 0.3;
        }
        
        body::before {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--accent-1), transparent);
            top: 10%;
            right: 5%;
        }
        
        body::after {
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, var(--accent-3), transparent);
            bottom: 10%;
            left: 5%;
        }
        
        .decorative-circle {
            position: fixed;
            border-radius: 50%;
            z-index: -1;
            opacity: 0.2;
        }
        
        .circle-1 {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--secondary-color), transparent);
            top: 60%;
            right: 10%;
        }
        
        .circle-2 {
            width: 180px;
            height: 180px;
            background: radial-gradient(circle, var(--accent-2), transparent);
            top: 15%;
            left: 8%;
        }
        
        /* A4纸尺寸容器 */
        .container {
            width: 100%;
            max-width: 794px;
            margin: 0 auto;
            background-color: var(--bg-white);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* 顶部区域 */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light), var(--primary-dark));
            color: white;
            padding: 30px 40px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .main-title {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .date-subtitle {
            font-size: 1.8rem;
            font-weight: 400;
            margin-bottom: 15px;
        }
        
        .slogan {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        /* 内容区域 */
        .content {
            padding: 30px 40px;
            flex-grow: 1;
        }
        
        /* 说明区域 */
        .instructions {
            background-color: rgba(88, 144, 16, 0.05);
            border-left: 5px solid var(--primary-color);
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 0 8px 8px 0;
        }
        
        .instructions h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .instructions ol {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .example {
            background-color: white;
            padding: 12px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            border: 1px dashed var(--border-color);
        }
        
        /* 操作按钮区域 */
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--accent-3);
            color: var(--text-dark);
        }
        
        .btn-secondary:hover {
            background-color: #C8D8CE;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background-color: var(--accent-2);
            color: var(--text-dark);
        }
        
        .btn-warning:hover {
            background-color: #F5C845;
            transform: translateY(-2px);
        }
        
        .btn-info {
            background-color: var(--secondary-color);
            color: var(--text-dark);
        }
        
        .btn-info:hover {
            background-color: #97B8E8;
            transform: translateY(-2px);
        }
        
        /* 学生信息编辑区 */
        .student-info {
            background-color: rgba(88, 144, 16, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid rgba(88, 144, 16, 0.1);
        }
        
        .student-info h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .input-field {
            flex: 1;
            min-width: 250px;
        }
        
        .input-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .input-field input,
        .input-field textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .input-field input:focus,
        .input-field textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(88, 144, 16, 0.2);
        }
        
        .input-field textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* 文件导入区域 */
        .file-import {
            background-color: rgba(168, 200, 232, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid rgba(168, 200, 232, 0.3);
        }
        
        .file-import h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-input-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .file-input-wrapper {
            position: relative;
            flex: 1;
            min-width: 200px;
        }
        
        .file-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
        }
        
        .file-input::-webkit-file-upload-button {
            background-color: var(--secondary-color);
            color: var(--text-dark);
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            margin-right: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .file-input::-webkit-file-upload-button:hover {
            background-color: #97B8E8;
        }
        
        .file-import-info {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 10px;
        }
        
        .file-format-example {
            background-color: white;
            padding: 12px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            border: 1px dashed var(--border-color);
            margin-top: 10px;
            font-family: 'Courier New', monospace;
        }
        
        /* 打卡记录区域 */
        .time-slots-container {
            margin-bottom: 40px;
        }
        
        .time-slots-container h3 {
            color: var(--primary-color;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-indicator {
            font-size: 1rem;
            color: var(--text-light);
            font-weight: normal;
            background-color: rgba(88, 144, 16, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .time-slot {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            page-break-inside: avoid;
        }
        
        .time-slot:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
        }
        
        .time-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .time-label {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .imported-content {
            background-color: rgba(168, 200, 232, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 3px solid var(--secondary-color);
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .content-input {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
            min-height: 100px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .content-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .time-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .check-btn {
            background-color: var(--unchecked-color);
            color: var(--text-dark);
            border: none;
            border-radius: 8px;
            padding: 8px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .check-btn:hover {
            background-color: #F5C9C1;
        }
        
        .check-btn.checked {
            background-color: var(--checked-color);
        }
        
        .check-btn.checked i {
            color: #5D8AA8;
        }
        
        /* 学生页面HTML代码区域 */
        .html-code-container {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }
        
        .html-code-container h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .html-code-box {
            background-color: #2d2d2d;
            color: #f8f8f2;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 15px;
            border: 1px solid #444;
        }
        
        .code-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .code-instructions {
            background-color: rgba(88, 144, 16, 0.05);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            border-left: 3px solid var(--primary-color);
        }
        
        .code-instructions ol {
            padding-left: 20px;
            margin-top: 10px;
        }
        
        .code-instructions li {
            margin-bottom: 5px;
        }
        
        /* 底部区域 */
        .footer {
            text-align: center;
            padding: 20px;
            background-color: rgba(88, 144, 16, 0.05);
            border-top: 1px solid var(--border-color);
            font-size: 0.95rem;
            color: var(--text-light);
            flex-shrink: 0;
        }
        
        /* 打印样式 */
        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
                max-width: 100%;
            }
            
            .instructions,
            .actions,
            .student-info .input-field:last-child,
            .file-import,
            .html-code-container,
            .footer {
                display: none !important;
            }
            
            .time-slot {
                page-break-inside: avoid;
            }
            
            .time-slot:has(.content-input:empty) {
                display: none !important;
            }
        }
        
        /* 响应式设计 */
        @media (max-width: 850px) {
            .container {
                max-width: 95%;
            }
            
            .header {
                padding: 20px;
            }
            
            .main-title {
                font-size: 2.2rem;
            }
            
            .date-subtitle {
                font-size: 1.4rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .input-group {
                flex-direction: column;
                gap: 15px;
            }
            
            .input-field {
                min-width: 100%;
            }
            
            .file-input-wrapper {
                min-width: 100%;
            }
            
            .actions,
            .code-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .html-code-box {
                font-size: 0.8rem;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- 背景装饰元素 -->
    <div class="decorative-circle circle-1"></div>
    <div class="decorative-circle circle-2"></div>
    
    <div class="container">
        <!-- 顶部区域 -->
        <div class="header">
            <h1 class="main-title" id="mainTitle">Reborner 的今日成就</h1>
            <div class="date-subtitle" id="currentDate">2023年10月27日 星期五</div>
            <div class="slogan">天天进步，每日新生</div>
        </div>
        
        <!-- 内容区域 -->
        <div class="content">
            <!-- 说明区域 -->
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
                <ol>
                    <li>在"学生信息"区域输入学生姓名和今日学习寄语</li>
                    <li>在"文件导入"区域导入Word、Excel或TXT格式的作业文件</li>
                    <li>导入的内容将填充到对应时间段，只显示文件中实际存在的时间段</li>
                    <li>可在各时间段的文本框中补充或修改内容</li>
                    <li>点击打卡按钮标记完成情况</li>
                    <li>使用"保存今日记录"按钮保存当前进度到浏览器</li>
                    <li>使用"导出学生页面"按钮生成学生页面HTML代码</li>
                    <li>复制HTML代码保存为HTML文件分享给学生</li>
                    <li>使用"导出Word文档"生成符合格式要求的Word文件</li>
                    <li>使用"重置所有记录"按钮清除所有填写内容</li>
                </ol>
                <div class="example">
                    <strong>文件格式说明：</strong> 文件内容按时间段排列，每个时间段以"hh:mm-hh:mm"格式开头。只有明确写有时间且有内容的时间段才会显示。
                </div>
            </div>
            
            <!-- 操作按钮区域 -->
            <div class="actions">
                <button class="btn btn-primary" id="saveBtn">
                    <i class="fas fa-save"></i> 保存今日记录
                </button>
                <button class="btn btn-primary" id="exportStudentBtn">
                    <i class="fas fa-share-square"></i> 导出学生页面
                </button>
                <button class="btn btn-secondary" id="exportWordBtn">
                    <i class="fas fa-file-word"></i> 导出Word文档
                </button>
                <button class="btn btn-warning" id="resetBtn">
                    <i class="fas fa-redo"></i> 重置所有记录
                </button>
            </div>
            
            <!-- 学生信息编辑区 -->
            <div class="student-info">
                <h3><i class="fas fa-user-edit"></i> 学生信息</h3>
                <div class="input-group">
                    <div class="input-field">
                        <label for="studentName">学生姓名</label>
                        <input type="text" id="studentName" placeholder="例如：杨乐" value="杨乐">
                    </div>
                </div>
                <div class="input-field">
                    <label for="studentMessage">今日学习寄语（学生页面将展示此内容）</label>
                    <textarea id="studentMessage" placeholder="输入给学生的今日学习寄语...">今天要按时完成各项学习任务，坚持就是胜利！</textarea>
                </div>
            </div>
            
            <!-- 文件导入区域 -->
            <div class="file-import">
                <h3><i class="fas fa-file-import"></i> 文件导入</h3>
                <div class="file-input-container">
                    <div class="file-input-wrapper">
                        <input type="file" id="fileInput" class="file-input" accept=".txt,.doc,.docx,.xls,.xlsx">
                    </div>
                    <button class="btn btn-info" id="importBtn">
                        <i class="fas fa-upload"></i> 导入文件
                    </button>
                </div>
                <div class="file-import-info">
                    <i class="fas fa-info-circle"></i> 支持导入TXT、Word、Excel格式文件。文件内容按时间段排列，每个时间段以"hh:mm-hh:mm"格式开头。只有明确写有时间且有内容的时间段才会显示。
                </div>
                <div class="file-format-example">
                    <strong>正确格式示例：</strong><br>
                    8:00-9:00<br>
                    晨读<br>
                    <br>
                    9:00-10:00<br>
                    雅思听力精讲精练课<br>
                    <br>
                    10:00-11:00<br>
                    雅思写作<br>
                    ----T1 地图类表达方式默写
                </div>
            </div>
            
            <!-- 打卡记录区域 -->
            <div class="time-slots-container">
                <h3>
                    <i class="far fa-clock"></i> 学习时间段记录
                    <span class="progress-indicator" id="progressIndicator">暂无时间段</span>
                </h3>
                
                <div id="timeSlots">
                    <!-- 时间段将由JavaScript动态生成 -->
                </div>
            </div>
            
            <!-- 学生页面HTML代码区域 -->
            <div class="html-code-container" id="htmlCodeContainer" style="display: none;">
                <h3><i class="fas fa-code"></i> 学生页面HTML代码</h3>
                <div class="code-actions">
                    <button class="btn btn-primary" id="copyCodeBtn">
                        <i class="far fa-copy"></i> 复制代码
                    </button>
                    <button class="btn btn-secondary" id="downloadCodeBtn">
                        <i class="fas fa-download"></i> 下载HTML文件
                    </button>
                </div>
                <div class="html-code-box" id="htmlCodeBox">
                    <!-- HTML代码将显示在这里 -->
                </div>
                <div class="code-instructions">
                    <strong>使用方法：</strong>
                    <ol>
                        <li>点击"复制代码"按钮复制HTML代码</li>
                        <li>打开文本编辑器（如记事本），粘贴代码</li>
                        <li>将文件保存为 <strong>学生姓名_今日学习.html</strong></li>
                        <li>将此HTML文件发送给学生，学生可以用浏览器直接打开查看</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <!-- 底部区域 -->
        <div class="footer">
            <div style="font-size: 0.95rem;">Reborner 每日成就打卡系统 | 记录点滴进步，成就更好的自己</div>
            <div style="font-size: 0.85rem; margin-top: 5px;">教师端 - 支持文件导入，生成学生页面HTML代码</div>
        </div>
    </div>
    
    <!-- 导入外部库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.5.1/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // 获取当前日期
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            const weekdays = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
            const weekday = weekdays[now.getDay()];
            return `${year}年${month}月${day}日 ${weekday}`;
        }
        
        // 存储时间段数据
        let timeSlotsData = [];
        
        // 更新主标题
        function updateMainTitle() {
            const studentName = document.getElementById('studentName').value || '';
            const title = studentName ? `Reborner ${studentName}的今日成就` : 'Reborner 的今日成就';
            document.getElementById('mainTitle').textContent = title;
        }
        
        // 更新进度指示器
        function updateProgressIndicator() {
            if (timeSlotsData.length === 0) {
                document.getElementById('progressIndicator').textContent = '暂无时间段';
                return;
            }
            
            const filledCount = timeSlotsData.filter(slot => slot.hasContent).length;
            const checkedCount = timeSlotsData.filter(slot => slot.checked && slot.hasContent).length;
            document.getElementById('progressIndicator').textContent = `已完成 ${checkedCount} / 共 ${filledCount} 个时间段`;
        }
        
        // 渲染时间段 - 只显示有内容的时间段
        function renderTimeSlots() {
            const container = document.getElementById('timeSlots');
            container.innerHTML = '';
            
            // 只显示有内容的时间段
            const filledTimeSlots = timeSlotsData.filter(slot => slot.hasContent);
            
            if (filledTimeSlots.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-light);">
                        <i class="far fa-clock" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>暂无时间段记录</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">请导入文件，系统将根据文件中的实际时间显示对应时间段</p>
                    </div>
                `;
                return;
            }
            
            filledTimeSlots.forEach(slot => {
                const slotElement = document.createElement('div');
                slotElement.className = 'time-slot';
                slotElement.innerHTML = `
                    <div class="time-header">
                        <div class="time-label">${slot.time}</div>
                    </div>
                    ${slot.importedContent ? `<div class="imported-content">${slot.importedContent}</div>` : ''}
                    <textarea class="content-input" placeholder="在此输入或修改本时间段的学习内容..." data-id="${slot.id}">${slot.content || ''}</textarea>
                    <div class="time-footer">
                        <div style="font-size: 0.9rem; color: var(--text-light);">
                            <i class="far fa-edit"></i> 可在此补充或修改
                        </div>
                        <button class="check-btn ${slot.checked ? 'checked' : ''}" data-id="${slot.id}">
                            <i class="${slot.checked ? 'fas fa-check-circle' : 'far fa-circle'}"></i>
                            ${slot.checked ? '已打卡' : '打卡'}
                        </button>
                    </div>
                `;
                container.appendChild(slotElement);
            });
            
            // 添加事件监听
            document.querySelectorAll('.content-input').forEach(input => {
                input.addEventListener('input', function() {
                    const id = this.getAttribute('data-id');
                    const slot = timeSlotsData.find(slot => slot.id === id);
                    slot.content = this.value;
                    
                    // 更新内容标记
                    slot.hasContent = (slot.importedContent && slot.importedContent.trim() !== '') || 
                                    (slot.content && slot.content.trim() !== '');
                    
                    saveToLocalStorage();
                    updateProgressIndicator();
                });
            });
            
            document.querySelectorAll('.check-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const slot = timeSlotsData.find(slot => slot.id === id);
                    slot.checked = !slot.checked;
                    
                    this.classList.toggle('checked');
                    this.innerHTML = slot.checked ? 
                        '<i class="fas fa-check-circle"></i> 已打卡' : 
                        '<i class="far fa-circle"></i> 打卡';
                    
                    saveToLocalStorage();
                    updateProgressIndicator();
                });
            });
            
            updateProgressIndicator();
        }
        
        // 保存到本地存储
        function saveToLocalStorage() {
            const data = {
                studentName: document.getElementById('studentName').value,
                studentMessage: document.getElementById('studentMessage').value,
                timeSlots: timeSlotsData,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('rebornerTeacherData', JSON.stringify(data));
        }
        
        // 从本地存储加载
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('rebornerTeacherData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    document.getElementById('studentName').value = data.studentName || '';
                    document.getElementById('studentMessage').value = data.studentMessage || '';
                    
                    // 加载保存的时间段数据
                    if (data.timeSlots && data.timeSlots.length > 0) {
                        timeSlotsData = data.timeSlots;
                        renderTimeSlots();
                    }
                    
                    updateMainTitle();
                } catch (e) {
                    console.error('加载保存的数据时出错:', e);
                }
            }
        }
        
        // 重置所有记录
        function resetAll() {
            if (confirm('确定要重置所有记录吗？此操作将清除所有内容和导入数据。')) {
                timeSlotsData = [];
                document.getElementById('studentName').value = '杨乐';
                document.getElementById('studentMessage').value = '今天要按时完成各项学习任务，坚持就是胜利！';
                document.getElementById('fileInput').value = '';
                renderTimeSlots();
                updateMainTitle();
                saveToLocalStorage();
                document.getElementById('htmlCodeContainer').style.display = 'none';
            }
        }
        
        // 读取TXT文件
        function readTxtFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.onerror = function() {
                    reject(new Error('读取TXT文件失败'));
                };
                reader.readAsText(file);
            });
        }
        
        // 读取Word文件
        function readWordFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const arrayBuffer = e.target.result;
                    mammoth.extractRawText({ arrayBuffer: arrayBuffer })
                        .then(result => {
                            console.log('Word文件提取结果:', result.value);
                            resolve(result.value);
                        })
                        .catch(error => {
                            console.error('Word文件解析错误:', error);
                            reject(new Error('Word文件解析失败，请确保是有效的.docx/.doc文件'));
                        });
                };
                reader.onerror = function() {
                    reject(new Error('读取Word文件失败'));
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // 读取Excel文件
        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const content = XLSX.utils.sheet_to_csv(firstSheet);
                        console.log('Excel文件提取结果:', content);
                        resolve(content);
                    } catch (error) {
                        console.error('Excel文件解析错误:', error);
                        reject(new Error('Excel文件解析失败，请确保是有效的.xlsx/.xls文件'));
                    }
                };
                reader.onerror = function() {
                    reject(new Error('读取Excel文件失败'));
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // 解析文件内容并分配到时间段
        function parseFileContent(content) {
            console.log('原始文件内容:', content);
            
            // 按行分割内容
            const lines = content.split(/\r?\n/);
            console.log('分割后的行:', lines);
            
            // 清空时间段数据
            timeSlotsData = [];
            
            // 解析每一行，识别时间段和内容
            let currentTimeSlot = null;
            let currentContentLines = [];
            let slotId = 1;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // 检查是否是时间格式的行 (如: 8:00-9:00, 09:00-10:00等)
                const timePattern = /^(\d{1,2}:\d{2})\s*[-~]\s*(\d{1,2}:\d{2})$/;
                const match = line.match(timePattern);
                
                if (match) {
                    // 如果之前已经有一个时间段在处理，先保存它
                    if (currentTimeSlot) {
                        if (currentContentLines.length > 0) {
                            // 合并多行内容
                            const content = currentContentLines.join('\n').trim();
                            if (content) {
                                currentTimeSlot.importedContent = content;
                                currentTimeSlot.hasContent = true;
                                timeSlotsData.push(currentTimeSlot);
                                slotId++;
                            }
                        }
                        // 清空当前内容
                        currentContentLines = [];
                    }
                    
                    // 创建新的时间段
                    currentTimeSlot = {
                        id: `slot_${slotId}`,
                        time: match[0], // 完整的时间字符串
                        importedContent: "",
                        content: "",
                        checked: false,
                        hasContent: false
                    };
                } else if (currentTimeSlot && line !== '') {
                    // 如果是非空行且当前有正在处理的时间段，则添加到内容中
                    currentContentLines.push(line);
                } else if (line === '' && currentTimeSlot) {
                    // 空行表示当前时间段内容结束
                    if (currentContentLines.length > 0) {
                        const content = currentContentLines.join('\n').trim();
                        if (content) {
                            currentTimeSlot.importedContent = content;
                            currentTimeSlot.hasContent = true;
                            timeSlotsData.push(currentTimeSlot);
                            slotId++;
                        }
                    }
                    currentTimeSlot = null;
                    currentContentLines = [];
                }
            }
            
            // 处理最后一个时间段
            if (currentTimeSlot && currentContentLines.length > 0) {
                const content = currentContentLines.join('\n').trim();
                if (content) {
                    currentTimeSlot.importedContent = content;
                    currentTimeSlot.hasContent = true;
                    timeSlotsData.push(currentTimeSlot);
                }
            }
            
            console.log('处理后的时间段数据:', timeSlotsData);
            return timeSlotsData.length;
        }
        
        // 导入文件
        async function importFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('请选择要导入的文件');
                return;
            }
            
            const fileExt = file.name.split('.').pop().toLowerCase();
            const fileSize = file.size / 1024 / 1024; // MB
            
            if (fileSize > 10) {
                alert('文件太大，请选择小于10MB的文件');
                return;
            }
            
            try {
                let content;
                
                // 根据文件类型选择读取方法
                if (fileExt === 'txt') {
                    content = await readTxtFile(file);
                } else if (fileExt === 'docx' || fileExt === 'doc') {
                    content = await readWordFile(file);
                } else if (fileExt === 'xlsx' || fileExt === 'xls') {
                    content = await readExcelFile(file);
                } else {
                    alert('不支持的文件格式。请选择TXT、Word(.doc/.docx)或Excel(.xls/.xlsx)文件。');
                    return;
                }
                
                // 解析内容并分配到时间段
                const importedCount = parseFileContent(content);
                
                if (importedCount === 0) {
                    alert('文件导入成功，但未找到有效的时间段内容。\n\n请检查文件格式：\n1. 时间段必须以"hh:mm-hh:mm"格式开头（如：8:00-9:00）\n2. 时间段下方必须有内容\n3. 空行表示时间段内容结束');
                    return;
                }
                
                // 重新渲染时间段
                renderTimeSlots();
                
                // 保存到本地存储
                saveToLocalStorage();
                
                alert(`文件"${file.name}"导入成功！\n共识别并导入 ${importedCount} 个时间段的内容。`);
                
            } catch (error) {
                console.error('文件导入失败:', error);
                alert(`文件导入失败：${error.message}\n\n建议：\n1. 使用TXT格式（最简单）\n2. 确保时间段格式为"hh:mm-hh:mm"\n3. 每个时间段下面必须有内容`);
            }
        }
        
        // 生成学生页面HTML
        function generateStudentHTML() {
            // 收集数据
            const studentName = document.getElementById('studentName').value || '学生';
            const studentMessage = document.getElementById('studentMessage').value || '';
            const date = getCurrentDate();
            
            // 过滤有内容的时间段
            const filledTimeSlots = timeSlotsData.filter(slot => slot.hasContent);
            
            // 生成学生页面HTML
            return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${studentName}的今日学习成就</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #589010;
            --primary-light: #78B030;
            --primary-dark: #3A7000;
            --accent-1: #F9D9D1;
            --accent-2: #FDD95E;
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #FFFEF7;
            --bg-white: #FFFFFF;
            --border-color: #E8E8E8;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --unchecked-color: #F9D9D1;
            --checked-color: #FDD95E;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-dark);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .container {
            width: 100%;
            max-width: 794px;
            background-color: var(--bg-white);
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        /* 顶部区域 */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light), var(--primary-dark));
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        .main-title {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        
        .date-subtitle {
            font-size: 1.4rem;
            font-weight: 400;
            margin-bottom: 10px;
        }
        
        .slogan {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        /* 内容区域 */
        .content {
            padding: 25px 30px;
        }
        
        /* 学生寄语 */
        .student-message {
            background-color: rgba(88, 144, 16, 0.05);
            border-left: 5px solid var(--primary-color);
            padding: 18px;
            margin-bottom: 25px;
            border-radius: 0 8px 8px 0;
            font-size: 1.05rem;
            line-height: 1.6;
        }
        
        .student-message h3 {
            color: var(--primary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
        }
        
        /* 打卡记录区域 */
        .time-slots-container {
            margin-bottom: 25px;
        }
        
        .time-slots-container h3 {
            color: var(--primary-color);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.3rem;
        }
        
        .progress-indicator {
            font-size: 0.95rem;
            color: var(--text-light);
            font-weight: normal;
            background-color: rgba(88, 144, 16, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
        }
        
        .time-slot {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 18px;
        }
        
        .time-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .time-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .content-display {
            padding: 12px;
            border-left: 3px solid var(--primary-color);
            background-color: rgba(88, 144, 16, 0.05);
            border-radius: 0 6px 6px 0;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 12px;
            white-space: pre-line;
        }
        
        .time-footer {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
        
        .status-badge {
            background-color: var(--unchecked-color);
            color: var(--text-dark);
            border-radius: 6px;
            padding: 6px 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-badge.checked {
            background-color: var(--checked-color);
        }
        
        /* 底部区域 */
        .footer {
            text-align: center;
            padding: 18px;
            background-color: rgba(88, 144, 16, 0.05);
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        /* 响应式设计 */
        @media (max-width: 850px) {
            .header {
                padding: 20px;
            }
            
            .main-title {
                font-size: 1.8rem;
            }
            
            .date-subtitle {
                font-size: 1.2rem;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 顶部区域 -->
        <div class="header">
            <h1 class="main-title">Reborner ${studentName}的今日学习</h1>
            <div class="date-subtitle">${date}</div>
            <div class="slogan">天天进步，每日新生</div>
        </div>
        
        <!-- 内容区域 -->
        <div class="content">
            <!-- 学生寄语 -->
            <div class="student-message">
                <h3><i class="fas fa-comment-dots"></i> 今日学习寄语</h3>
                <div>${studentMessage.replace(/\n/g, '<br>')}</div>
            </div>
            
            <!-- 打卡记录区域 -->
            <div class="time-slots-container">
                <h3>
                    <i class="far fa-clock"></i> 今日学习记录
                    <span class="progress-indicator">已完成 ${filledTimeSlots.filter(slot => slot.checked).length} / ${filledTimeSlots.length} 个时间段</span>
                </h3>
                
                <div id="timeSlots">
                    ${filledTimeSlots.map(slot => {
                        const displayContent = slot.content && slot.content.trim() !== '' ? slot.content : slot.importedContent;
                        return `
                    <div class="time-slot">
                        <div class="time-header">
                            <div class="time-label">${slot.time}</div>
                        </div>
                        <div class="content-display">${displayContent}</div>
                        <div class="time-footer">
                            <div class="status-badge ${slot.checked ? 'checked' : ''}">
                                <i class="${slot.checked ? 'fas fa-check-circle' : 'far fa-circle'}"></i>
                                ${slot.checked ? '已完成' : '未完成'}
                            </div>
                        </div>
                    </div>
                    `}).join('')}
                </div>
            </div>
        </div>
        
        <!-- 底部区域 -->
        <div class="footer">
            <div>Reborner 每日成就打卡系统 | 记录点滴进步，成就更好的自己</div>
        </div>
    </div>
</body>
</html>`;
        }
        
        // 显示学生页面HTML代码
        function showStudentHTMLCode() {
            // 验证必填项
            const studentName = document.getElementById('studentName').value.trim();
            if (!studentName) {
                alert('请先输入学生姓名');
                document.getElementById('studentName').focus();
                return;
            }
            
            // 检查是否有时间段内容
            if (timeSlotsData.length === 0) {
                alert('请先导入文件，文件中需要包含时间段的作业内容');
                return;
            }
            
            // 生成HTML代码
            const htmlCode = generateStudentHTML();
            
            // 显示代码
            document.getElementById('htmlCodeBox').textContent = htmlCode;
            document.getElementById('htmlCodeContainer').style.display = 'block';
            
            // 滚动到代码区域
            document.getElementById('htmlCodeContainer').scrollIntoView({ behavior: 'smooth' });
        }
        
        // 复制HTML代码
        function copyHTMLCode() {
            const codeBox = document.getElementById('htmlCodeBox');
            const textarea = document.createElement('textarea');
            textarea.value = codeBox.textContent;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            alert('HTML代码已复制到剪贴板！\n\n现在您可以粘贴到文本编辑器中，保存为HTML文件。');
        }
        
        // 下载HTML文件
        function downloadHTMLFile() {
            const studentName = document.getElementById('studentName').value.trim() || '学生';
            const htmlCode = generateStudentHTML();
            
            // 创建Blob对象
            const blob = new Blob([htmlCode], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            // 创建下载链接
            const a = document.createElement('a');
            a.href = url;
            a.download = `${studentName}_今日学习_${new Date().toISOString().slice(0, 10)}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // 释放URL对象
            setTimeout(() => URL.revokeObjectURL(url), 100);
        }
        
        // 导出Word文档
        function exportWordDocument() {
            // 收集数据
            const studentName = document.getElementById('studentName').value || '学生';
            const date = getCurrentDate();
            const studentMessage = document.getElementById('studentMessage').value || '';
            
            // 过滤有内容的时间段
            const filledTimeSlots = timeSlotsData.filter(slot => slot.hasContent);
            
            if (filledTimeSlots.length === 0) {
                alert('请先导入文件或在时间段中添加内容');
                return;
            }
            
            // 创建Word文档内容
            let wordContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <style>
                        @page {
                            size: A4;
                            margin: 2cm;
                        }
                        body { 
                            font-family: 'Microsoft YaHei', sans-serif; 
                            margin: 0;
                            padding: 0;
                            width: 21cm;
                        }
                        .page {
                            padding: 2cm;
                            box-sizing: border-box;
                        }
                        .title { 
                            font-size: 36pt; 
                            font-weight: bold; 
                            text-align: center; 
                            margin-bottom: 20px; 
                            color: #589010;
                        }
                        .date { 
                            font-size: 24pt; 
                            text-align: center; 
                            margin-bottom: 40px; 
                        }
                        .time-slot { 
                            margin-bottom: 30px;
                            page-break-inside: avoid;
                        }
                        .time-label { 
                            font-size: 18pt; 
                            font-weight: bold; 
                            margin-bottom: 10px; 
                            color: #589010;
                        }
                        .content { 
                            font-size: 14pt; 
                            margin-bottom: 10px;
                            line-height: 1.6;
                        }
                        .status { 
                            font-size: 12pt; 
                            color: #666;
                        }
                        .section-title {
                            font-size: 16pt;
                            font-weight: bold;
                            margin-bottom: 20px;
                            border-bottom: 2px solid #589010;
                            padding-bottom: 5px;
                        }
                        .empty-line { 
                            height: 20px; 
                        }
                        .student-message {
                            font-size: 14pt;
                            margin-bottom: 30px;
                            padding: 15px;
                            background-color: #f9f9f9;
                            border-left: 4px solid #589010;
                        }
                    </style>
                </head>
                <body>
                    <div class="page">
                        <div class="title">Reborner ${studentName}的今日成就</div>
                        <div class="date">${date}</div>
                        
                        <div class="section-title">今日学习寄语</div>
                        <div class="student-message">${studentMessage.replace(/\n/g, '<br>')}</div>
                        
                        <div class="section-title">今日学习记录</div>
            `;
            
            // 添加时间段
            filledTimeSlots.forEach((slot, index) => {
                const displayContent = slot.content && slot.content.trim() !== '' ? slot.content : slot.importedContent;
                
                wordContent += `
                        <div class="time-slot">
                            <div class="time-label">${slot.time}</div>
                            <div class="content">${displayContent.replace(/\n/g, '<br>')}</div>
                            <div class="status">${slot.checked ? '✓ 已完成' : '○ 未完成'}</div>
                        </div>
                `;
                
                // 在内容后和下一个时间段之间添加空行
                if (index < filledTimeSlots.length - 1) {
                    wordContent += '<div class="empty-line"></div>';
                }
            });
            
            wordContent += `
                    </div>
                </body>
                </html>
            `;
            
            // 创建Blob对象
            const blob = new Blob([wordContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            
            // 创建下载链接
            const a = document.createElement('a');
            a.href = url;
            a.download = `Reborner_${studentName}_${new Date().toISOString().slice(0, 10)}.doc`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // 释放URL对象
            setTimeout(() => URL.revokeObjectURL(url), 100);
        }
        
        // 初始化
        // 设置当前日期
        document.getElementById('currentDate').textContent = getCurrentDate();
        
        // 加载保存的数据
        loadFromLocalStorage();
        
        // 事件监听
        document.getElementById('studentName').addEventListener('input', function() {
            updateMainTitle();
            saveToLocalStorage();
        });
        
        document.getElementById('studentMessage').addEventListener('input', saveToLocalStorage);
        
        document.getElementById('saveBtn').addEventListener('click', function() {
            saveToLocalStorage();
            alert('今日记录已保存到本地！');
        });
        
        document.getElementById('exportStudentBtn').addEventListener('click', showStudentHTMLCode);
        
        document.getElementById('exportWordBtn').addEventListener('click', exportWordDocument);
        
        document.getElementById('resetBtn').addEventListener('click', resetAll);
        
        document.getElementById('copyCodeBtn').addEventListener('click', copyHTMLCode);
        
        document.getElementById('downloadCodeBtn').addEventListener('click', downloadHTMLFile);
        
        document.getElementById('importBtn').addEventListener('click', importFile);
        
        // 初始更新
        updateMainTitle();
        updateProgressIndicator();
        
        // 打印提示
        console.log("提示：使用浏览器打印功能(Ctrl+P)可以导出PDF格式，页面已优化为A4纸尺寸。");
    </script>
</body>
</html>